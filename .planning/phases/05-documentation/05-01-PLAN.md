---
phase: 05-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - SKILL.md
  - docs/hooks.md
  - /home/forge/.openclaw/workspace/TOOLS.md
autonomous: true
requirements:
  - DOCS-01

must_haves:
  truths:
    - "SKILL.md teaches an agent how to launch a new GSD session in under 200 lines / under 1500 tokens"
    - "SKILL.md contains a quick-start flow as the first substantive section"
    - "SKILL.md lists all 5 hook scripts with one-line summaries and references docs/hooks.md for details"
    - "SKILL.md documents spawn.sh, recover-openclaw-agents.sh, menu-driver.sh, sync-recovery-registry-session-ids.sh, and register-hooks.sh with happy-path examples"
    - "docs/hooks.md contains full behavior specs for all 5 hooks grouped by purpose (wake hooks vs lifecycle hooks)"
    - "TOOLS.md gsd-code-skill section lists only agent-invocable scripts (spawn, recover, menu-driver, sync, register-hooks)"
  artifacts:
    - path: "SKILL.md"
      provides: "Agent-facing skill documentation with progressive disclosure"
      contains: "## Quick Start"
    - path: "docs/hooks.md"
      provides: "Deep-dive hook behavior specs for all 5 hooks"
      contains: "## stop-hook.sh"
    - path: "/home/forge/.openclaw/workspace/TOOLS.md"
      provides: "Updated gsd-code-skill script inventory"
      contains: "scripts/spawn.sh"
  key_links:
    - from: "SKILL.md"
      to: "docs/hooks.md"
      via: "reference link for hook details"
      pattern: "docs/hooks\\.md"
    - from: "SKILL.md"
      to: "README.md"
      via: "reference link for registry schema"
      pattern: "README\\.md"
---

<objective>
Rewrite SKILL.md as a token-efficient agent-facing document with progressive disclosure, create docs/hooks.md with full hook behavior specs, and update TOOLS.md with the current script inventory.

Purpose: Agents need lean, action-oriented documentation to spawn and manage GSD sessions without overloading their context window. Hook deep-dives live in a separate file loaded only when needed.

Output: Rewritten SKILL.md (<200 lines), new docs/hooks.md, updated TOOLS.md gsd-code-skill section.
</objective>

<execution_context>
@/home/forge/.claude/get-shit-done/workflows/execute-plan.md
@/home/forge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-documentation/05-CONTEXT.md
@.planning/phases/05-documentation/05-RESEARCH.md

Source files to reference for accurate documentation:
@scripts/spawn.sh
@scripts/recover-openclaw-agents.sh
@scripts/menu-driver.sh
@scripts/register-hooks.sh
@scripts/sync-recovery-registry-session-ids.sh
@scripts/stop-hook.sh
@scripts/notification-idle-hook.sh
@scripts/notification-permission-hook.sh
@scripts/session-end-hook.sh
@scripts/pre-compact-hook.sh
@config/recovery-registry.example.json
@config/default-system-prompt.txt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite SKILL.md and create docs/hooks.md</name>
  <files>SKILL.md, docs/hooks.md</files>
  <action>
Rewrite SKILL.md as an agent-facing document following the progressive disclosure pattern. Clean slate approach -- no mention of old polling system (autoresponder, hook-watcher, gsd-session-hook). Document current architecture as if it always existed.

**SKILL.md structure** (target: under 200 lines, under 1500 tokens):

1. YAML frontmatter (keep existing name, description, metadata -- update description if needed to reflect hook-driven architecture)

2. **## Quick Start** (first substantive section per locked decision)
   Step-by-step: configure registry entry, register hooks, spawn session. Show the three commands needed. Brief enough to act on immediately.

3. **## Lifecycle** (narrative per locked decision)
   One paragraph explaining: spawn -> hooks control session -> crash/reboot -> systemd timer -> recovery -> agents resume. No deep details, just the mental model.

4. **## Scripts** (grouped by role per locked decision)
   Three groups:
   - **Session Management:** spawn.sh, recover-openclaw-agents.sh, sync-recovery-registry-session-ids.sh
   - **Hooks:** stop-hook.sh, notification-idle-hook.sh, notification-permission-hook.sh, session-end-hook.sh, pre-compact-hook.sh (one-line summaries only, reference docs/hooks.md)
   - **Utilities:** menu-driver.sh, register-hooks.sh

   For Session Management and Utilities scripts: include happy-path usage example (the command with minimal args). No flags documentation inline -- reference `--help` for full options.

   For Hook scripts: one-line summary per hook, then a line saying "For hook behavior specs, configuration, and edge cases, load `docs/hooks.md`"

5. **## Configuration** (brief)
   - Registry: `config/recovery-registry.json` -- mention three-tier fallback concept, reference README.md for full schema
   - System prompt: `config/default-system-prompt.txt` -- one sentence explaining replacement model (per-agent overrides default)
   - Hooks registered in `~/.claude/settings.json` via `scripts/register-hooks.sh`

6. **## Notes** (brief)
   - Recovery runbook and systemd setup in README.md
   - No Python dependency -- all operations use jq

**docs/hooks.md structure:**

Create `docs/` directory. Write `docs/hooks.md` with full behavior specs for all 5 hooks.

Use this structure per hook (from locked decisions and research):

1. Section per hook (## hook-name.sh)
2. **Trigger:** What Claude Code event fires this hook
3. **What It Does:** Numbered step-by-step of the hook's logic (read the actual script for accuracy)
4. **Configuration (hook_settings):** Which hook_settings fields affect this hook, with defaults
5. **Edge Cases:** Exit conditions (no $TMUX, no registry match, guard conditions)
6. **Exit Time:** Performance characteristics
7. **Related Registry Fields:** Which fields in recovery-registry.json this hook reads

Group hooks by purpose:
- **# Wake Hooks** (stop-hook.sh, notification-idle-hook.sh, notification-permission-hook.sh) -- these notify the OpenClaw agent
- **# Lifecycle Hooks** (session-end-hook.sh, pre-compact-hook.sh) -- these track state

Include a brief intro section explaining:
- All hooks are registered in `~/.claude/settings.json` via `scripts/register-hooks.sh`
- All hooks share common guard patterns: consume stdin, check $TMUX, lookup registry
- Non-managed sessions exit cleanly in under 5ms
- Hooks use jq for all registry operations
- hook_settings use three-tier fallback: per-agent > global > hardcoded

Include inline hook_settings JSON snippet examples where relevant (per locked decision).

Read each hook script to accurately document its behavior. Do NOT guess -- base documentation on actual code.
  </action>
  <verify>
Verify SKILL.md:
- `wc -l SKILL.md` -- should be under 200 lines
- Contains "## Quick Start" section
- Contains "docs/hooks.md" reference
- Contains "README.md" reference for registry schema
- Does NOT contain "autoresponder", "hook-watcher", or "gsd-session-hook"
- Lists all 5 hook scripts by name

Verify docs/hooks.md:
- File exists at docs/hooks.md
- Contains sections for all 5 hooks: stop-hook.sh, notification-idle-hook.sh, notification-permission-hook.sh, session-end-hook.sh, pre-compact-hook.sh
- Contains "Wake Hooks" and "Lifecycle Hooks" group headers
- Contains hook_settings JSON examples
  </verify>
  <done>
SKILL.md is a lean agent-facing document under 200 lines with quick-start flow, lifecycle narrative, grouped script inventory, and progressive disclosure references to docs/hooks.md and README.md. docs/hooks.md contains full behavior specs for all 5 hooks grouped by purpose with configuration, edge cases, and registry field references.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update TOOLS.md gsd-code-skill section</name>
  <files>/home/forge/.openclaw/workspace/TOOLS.md</files>
  <action>
Update the `### gsd-code-skill` section in TOOLS.md (located at /home/forge/.openclaw/workspace/TOOLS.md). Currently this section is empty (just the heading followed by blank lines before `## Server Environment`).

Per locked decisions, TOOLS.md lists only agent-invocable scripts -- hook scripts excluded since they fire automatically.

Replace the empty section content with:

```
### gsd-code-skill
- skill: `skills/gsd-code-skill/SKILL.md`
- purpose: Launch, recover, and manage strict GSD-only Claude Code sessions with event-driven hook control
- scripts:
  - `skills/gsd-code-skill/scripts/spawn.sh <agent-name> <workdir> [first-command]` -- spawn a GSD Claude Code session in tmux
  - `skills/gsd-code-skill/scripts/recover-openclaw-agents.sh [--dry-run]` -- deterministic multi-agent recovery after reboot/OOM
  - `skills/gsd-code-skill/scripts/menu-driver.sh <session> <action> [args]` -- deterministic tmux TUI helper for menu navigation
  - `skills/gsd-code-skill/scripts/sync-recovery-registry-session-ids.sh [--dry-run]` -- sync OpenClaw session ids into recovery registry
  - `skills/gsd-code-skill/scripts/register-hooks.sh` -- idempotent hook registration in ~/.claude/settings.json
```

Ensure no mention of autoresponder, hook-watcher, or gsd-session-hook (clean slate).
  </action>
  <verify>
- Read the gsd-code-skill section in TOOLS.md
- Contains exactly 5 script entries: spawn.sh, recover-openclaw-agents.sh, menu-driver.sh, sync-recovery-registry-session-ids.sh, register-hooks.sh
- Does NOT contain "autoresponder", "hook-watcher", or "gsd-session-hook"
- Does NOT list hook scripts (stop-hook.sh, notification-idle-hook.sh, etc.)
  </verify>
  <done>
TOOLS.md gsd-code-skill section lists 5 agent-invocable scripts with accurate descriptions, matching the current script inventory. Hook scripts excluded as they fire automatically.
  </done>
</task>

</tasks>

<verification>
1. SKILL.md line count under 200, contains Quick Start, references docs/hooks.md and README.md
2. docs/hooks.md has full specs for all 5 hooks, grouped by purpose, with hook_settings examples
3. TOOLS.md gsd-code-skill section has 5 agent-invocable scripts, no obsolete references
4. No file mentions autoresponder, hook-watcher, or gsd-session-hook (clean slate verified)
</verification>

<success_criteria>
- Agent can read SKILL.md and successfully spawn a new GSD session without loading additional docs
- Agent can load docs/hooks.md on demand when hook behavior is unexpected
- TOOLS.md accurately reflects current script inventory for agent discovery
- No references to deleted/obsolete scripts anywhere in updated documentation
</success_criteria>

<output>
After completion, create `.planning/phases/05-documentation/05-01-SUMMARY.md`
</output>
