---
phase: 17-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [docs/hooks.md, SKILL.md]
autonomous: true
requirements: [DOCS-04, DOCS-05]

must_haves:
  truths:
    - "docs/hooks.md shared library table lists load_hook_prompt() as function #10 with correct description"
    - "docs/hooks.md wake format section shows [ACTION REQUIRED] instead of [AVAILABLE ACTIONS]"
    - "docs/hooks.md has a prompt templates section listing all 7 template files with their trigger context"
    - "SKILL.md shared library line says 10 functions (not 9) and includes load_hook_prompt in the list"
    - "SKILL.md has a v3.2 version history entry describing per-hook prompt templates"
    - "SKILL.md lifecycle overview mentions per-hook prompt templates loaded from scripts/prompts/"
  artifacts:
    - path: "docs/hooks.md"
      provides: "Updated hook documentation with prompt template system"
      contains: "load_hook_prompt"
    - path: "SKILL.md"
      provides: "Updated skill documentation with v3.2 changes"
      contains: "v3.2"
  key_links:
    - from: "docs/hooks.md"
      to: "scripts/prompts/*.md"
      via: "prompt templates section"
      pattern: "scripts/prompts/"
    - from: "SKILL.md"
      to: "lib/hook-utils.sh"
      via: "function count reference"
      pattern: "10 functions"
---

<objective>
Update docs/hooks.md and SKILL.md to reflect the v3.2 prompt template system: load_hook_prompt() function, [ACTION REQUIRED] format replacing [AVAILABLE ACTIONS], 7 per-hook template files, and updated function count.

Purpose: Ensure agent-facing and technical hook documentation accurately describes the current v3.2 architecture where each hook loads trigger-specific action instructions from external templates.

Output: Updated docs/hooks.md and SKILL.md reflecting v3.2 prompt template system.
</objective>

<execution_context>
@/home/forge/.claude/get-shit-done/workflows/execute-plan.md
@/home/forge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@docs/hooks.md
@SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update docs/hooks.md with prompt template system</name>
  <files>docs/hooks.md</files>
  <action>
Make these specific changes to docs/hooks.md:

1. **Shared Library function table** (under "## Shared Library"): Change "9 functions" to "10 functions" in the description line. Add load_hook_prompt() as the 10th row in the function table:
   - Function: `load_hook_prompt`
   - Used By: all hooks
   - Purpose: Load per-hook prompt template from scripts/prompts/{name}.md, substitute {SESSION_NAME}, {MENU_DRIVER_PATH}, {SCRIPT_DIR} placeholders; graceful empty-string fallback on missing template

2. **Wake Format v2 section**: Change `[AVAILABLE ACTIONS]` to `[ACTION REQUIRED]` in the section order line. Update the breaking change note to mention that [AVAILABLE ACTIONS] was replaced by [ACTION REQUIRED] in v3.2, with content now loaded from per-hook templates via load_hook_prompt().

3. **Add new section "## Per-Hook Prompt Templates"** after the "Wake Format v2" section and before "## Log File Lifecycle". Content:
   - Brief intro: All 7 hooks load trigger-specific action instructions from external markdown templates via `load_hook_prompt()`. Templates live in `scripts/prompts/` and are substituted with three placeholders: `{SESSION_NAME}`, `{MENU_DRIVER_PATH}`, `{SCRIPT_DIR}`.
   - Table listing all 7 template files with columns: Template File, Hook Script, Trigger Context. Rows:
     - response-complete.md | stop-hook.sh | Agent finished responding (Stop event)
     - idle-prompt.md | notification-idle-hook.sh | Agent waiting for input (idle_prompt)
     - permission-prompt.md | notification-permission-hook.sh | Permission dialog (permission_prompt)
     - ask-user-question.md | pre-tool-use-hook.sh | AskUserQuestion about to render
     - answer-submitted.md | post-tool-use-hook.sh | AskUserQuestion answer received
     - pre-compact.md | pre-compact-hook.sh | Context compaction imminent
     - session-end.md | session-end-hook.sh | Session terminating
   - Note: If a template file is missing, load_hook_prompt() returns an empty string. The hook still fires and sends its wake message without the [ACTION REQUIRED] section content.
   - Note: Templates are plain text (no markdown headers) designed for embedding inside wake messages.

4. **Each hook's "What It Does" section**: In the numbered steps for each of the 7 hooks, where steps reference "available actions" or "available `menu-driver.sh` actions", update the wording to reference "[ACTION REQUIRED] section loaded from template via load_hook_prompt()". Specifically:
   - stop-hook.sh step 11: change "available `menu-driver.sh` actions" to "[ACTION REQUIRED] section loaded from response-complete.md template via load_hook_prompt()"
   - notification-idle-hook.sh step 11: update similarly to reference idle-prompt.md template
   - notification-permission-hook.sh: update the "Identical flow" note to mention [ACTION REQUIRED] from permission-prompt.md template
   - pre-tool-use-hook.sh step 8: update to mention [ACTION REQUIRED] from ask-user-question.md template
   - post-tool-use-hook.sh step 9: add mention of [ACTION REQUIRED] from answer-submitted.md template appended to wake message
   - session-end-hook.sh step 6: update to mention [ACTION REQUIRED] from session-end.md template appended to wake message
   - pre-compact-hook.sh step 11: change "available actions" to "[ACTION REQUIRED] section from pre-compact.md template via load_hook_prompt()"
  </action>
  <verify>
grep -c "load_hook_prompt" docs/hooks.md should return >= 10 (function table + 7 hook sections + templates section).
grep -c "AVAILABLE ACTIONS" docs/hooks.md should return 0.
grep -c "ACTION REQUIRED" docs/hooks.md should return >= 8.
grep "10 functions" docs/hooks.md should find the updated function count.
  </verify>
  <done>docs/hooks.md describes [ACTION REQUIRED] format, lists all 7 template files with trigger context, includes load_hook_prompt() in the shared library function table, and all 7 hook behavior specs reference their template name</done>
</task>

<task type="auto">
  <name>Task 2: Update SKILL.md with v3.2 changes</name>
  <files>SKILL.md</files>
  <action>
Make these specific changes to SKILL.md:

1. **Shared Libraries section**: Change "Contains 9 functions" to "Contains 10 functions" and add `load_hook_prompt` to the function list: `lookup_agent_in_registry`, `extract_last_assistant_response`, `extract_pane_diff`, `format_ask_user_questions`, `write_hook_event_record`, `deliver_async_with_logging`, `deliver_with_mode`, `extract_hook_settings`, `detect_session_state`, `load_hook_prompt`.

2. **Lifecycle section**: After the sentence "Hooks fire on Claude Code events..." add a note: "Each hook's wake message includes an [ACTION REQUIRED] section with trigger-specific instructions loaded from per-hook prompt templates in `scripts/prompts/`."

3. **Add v3.2 Changes section** after the existing "## v3.0 Changes" section. Content:

```
## v3.2 Changes

**Per-hook prompt templates:** All 7 hooks now load trigger-specific [ACTION REQUIRED] instructions from external markdown templates in `scripts/prompts/` via `load_hook_prompt()`. The generic [AVAILABLE ACTIONS] block (identical across all hooks) has been replaced by hook-specific action guidance tailored to each trigger context.

**Template placeholder substitution:** Templates support three placeholders ({SESSION_NAME}, {MENU_DRIVER_PATH}, {SCRIPT_DIR}) substituted at load time. Missing templates cause graceful fallback (empty string), never hook failure.

**Multi-select TUI actions:** `menu-driver.sh` now supports `arrow_up`, `arrow_down`, and `space` actions for navigating and toggling multi-select checkboxes in AskUserQuestion prompts.

**Minimum Claude Code version:** >= 2.0.76 (unchanged from v3.0).
```
  </action>
  <verify>
grep "10 functions" SKILL.md should find the updated count.
grep "load_hook_prompt" SKILL.md should find the function in the list.
grep "v3.2" SKILL.md should find the version section.
grep "ACTION REQUIRED" SKILL.md should find the lifecycle and v3.2 references.
  </verify>
  <done>SKILL.md function count says 10, load_hook_prompt is in the function list, v3.2 version history section exists, lifecycle overview mentions per-hook prompt templates</done>
</task>

</tasks>

<verification>
1. `grep -c "AVAILABLE ACTIONS" docs/hooks.md` returns 0 — no stale references
2. `grep -c "load_hook_prompt" docs/hooks.md` returns >= 10 — function table, 7 hooks, templates section
3. `grep "10 functions" docs/hooks.md` — updated count in shared library section
4. `grep "10 functions" SKILL.md` — updated count in shared libraries section
5. `grep "v3.2" SKILL.md` — version history section exists
6. `grep "ACTION REQUIRED" SKILL.md` — lifecycle and v3.2 references present
7. `grep "scripts/prompts/" docs/hooks.md` — template files section present
</verification>

<success_criteria>
- docs/hooks.md: load_hook_prompt() in function table, [ACTION REQUIRED] in wake format, prompt templates section with 7 template files, all hook specs reference their template
- SKILL.md: 10 functions, load_hook_prompt in list, v3.2 version history, lifecycle mentions prompt templates
- Zero occurrences of [AVAILABLE ACTIONS] in either file
</success_criteria>

<output>
After completion, create `.planning/phases/17-documentation/17-01-SUMMARY.md`
</output>
