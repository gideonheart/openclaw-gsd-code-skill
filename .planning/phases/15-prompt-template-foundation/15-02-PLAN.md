---
phase: 15-prompt-template-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/menu-driver.sh
autonomous: true
requirements:
  - TUI-01
  - TUI-02

must_haves:
  truths:
    - "An agent can navigate multi-select checkbox lists by sending arrow_up and arrow_down actions to menu-driver.sh"
    - "An agent can toggle checkbox selection by sending the space action to menu-driver.sh"
    - "The usage help text documents all three new actions (arrow_up, arrow_down, space)"
  artifacts:
    - path: "scripts/menu-driver.sh"
      provides: "arrow_up, arrow_down, space TUI actions"
      contains: "arrow_up"
  key_links:
    - from: "scripts/menu-driver.sh"
      to: "tmux send-keys"
      via: "Up, Down, Space key mappings"
      pattern: "send-keys.*Up|send-keys.*Down|send-keys.*Space"
---

<objective>
Add arrow_up, arrow_down, and space actions to scripts/menu-driver.sh for multi-select checkbox navigation in Claude Code's AskUserQuestion TUI.

Purpose: Claude Code's AskUserQuestion with multiSelect=true renders checkboxes that require arrow keys for navigation and space for toggling. Current menu-driver.sh only supports choose (number + enter) and type (literal text), which cannot interact with checkbox lists. These new actions enable the driving agent to navigate and toggle multi-select options before confirming with enter.

Output: menu-driver.sh extended with 3 new actions (arrow_up, arrow_down, space) using tmux send-keys.
</objective>

<execution_context>
@/home/forge/.claude/get-shit-done/workflows/execute-plan.md
@/home/forge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@scripts/menu-driver.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add arrow_up, arrow_down, and space actions to menu-driver.sh</name>
  <files>scripts/menu-driver.sh</files>
  <action>
Modify scripts/menu-driver.sh in two places:

**1. Update usage() help text** — Add the 3 new actions after `esc` and before `clear_then`:

```
  arrow_up                         Move cursor up one row (multi-select navigation)
  arrow_down                       Move cursor down one row (multi-select navigation)
  space                            Toggle checkbox selection at current row
```

**2. Add case branches** — Add 3 new case branches in the `case "$ACTION" in` block. Place them after the `esc)` branch and before the `clear_then)` branch to match the help text order:

```bash
  arrow_up)
    tmux send-keys -t "$SESSION:0.0" Up
    ;;
  arrow_down)
    tmux send-keys -t "$SESSION:0.0" Down
    ;;
  space)
    tmux send-keys -t "$SESSION:0.0" Space
    ;;
```

The tmux key names are: `Up` (arrow up), `Down` (arrow down), `Space` (spacebar). These are standard tmux send-keys key names — no `-l` flag needed since these are named keys, not literal text.

Do NOT modify any existing actions. The only changes are adding help text lines and case branches.
  </action>
  <verify>
Verify syntax is valid:
```bash
bash -n scripts/menu-driver.sh && echo "syntax ok"
```

Verify all 3 new actions appear in usage and case:
```bash
grep -c 'arrow_up\|arrow_down\|space' scripts/menu-driver.sh
# Should be at least 6 (3 in usage + 3 in case)
```

Verify the actions are recognized (dry run — will fail on "session not found" which is expected):
```bash
scripts/menu-driver.sh nonexistent-session arrow_up 2>&1 | grep -q "session not found" && echo "arrow_up recognized"
scripts/menu-driver.sh nonexistent-session arrow_down 2>&1 | grep -q "session not found" && echo "arrow_down recognized"
scripts/menu-driver.sh nonexistent-session space 2>&1 | grep -q "session not found" && echo "space recognized"
```

Verify unrecognized actions still show usage:
```bash
scripts/menu-driver.sh nonexistent-session bogus_action 2>&1 | grep -q "Usage" && echo "unknown action shows usage"
```
  </verify>
  <done>
menu-driver.sh accepts arrow_up, arrow_down, and space as valid actions. arrow_up sends tmux Up key, arrow_down sends tmux Down key, space sends tmux Space key. Usage help documents all three new actions. Existing actions remain unchanged.
  </done>
</task>

</tasks>

<verification>
1. `bash -n scripts/menu-driver.sh` exits 0 (no syntax errors)
2. `scripts/menu-driver.sh` with no args shows usage including arrow_up, arrow_down, space
3. Each new action is recognized as valid (does not fall through to usage/exit 1)
4. Existing actions (snapshot, enter, esc, clear_then, choose, type, submit) still work unchanged
</verification>

<success_criteria>
- arrow_up, arrow_down, and space actions added to menu-driver.sh case block
- Usage text updated with descriptions for all 3 new actions
- tmux send-keys uses correct key names (Up, Down, Space)
- No existing actions broken
- Script passes bash syntax validation
</success_criteria>

<output>
After completion, create `.planning/phases/15-prompt-template-foundation/15-02-SUMMARY.md`
</output>
