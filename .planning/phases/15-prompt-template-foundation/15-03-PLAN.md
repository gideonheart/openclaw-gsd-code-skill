---
phase: 15-prompt-template-foundation
plan: 03
type: execute
wave: 2
depends_on:
  - "15-01"
  - "15-02"
files_modified:
  - scripts/prompts/response-complete.md
  - scripts/prompts/ask-user-question.md
  - scripts/prompts/idle-prompt.md
  - scripts/prompts/permission-prompt.md
  - scripts/prompts/pre-compact.md
  - scripts/prompts/session-end.md
  - scripts/prompts/answer-submitted.md
autonomous: true
requirements:
  - PROMPT-02
  - PROMPT-03
  - PROMPT-04
  - PROMPT-05
  - PROMPT-06
  - PROMPT-07
  - PROMPT-08

must_haves:
  truths:
    - "All 7 template files exist at scripts/prompts/ and contain hook-specific instructions"
    - "ask-user-question.md includes explicit multi-select checkbox instructions (arrow_up, arrow_down, space, enter)"
    - "Each template contains only commands relevant to its trigger type — no template lists all menu-driver commands"
    - "Every template uses {SESSION_NAME}, {MENU_DRIVER_PATH}, and/or {SCRIPT_DIR} placeholders where paths appear"
    - "answer-submitted.md is informational only — no TUI action commands"
    - "session-end.md references spawn.sh for session restart — not menu-driver commands"
  artifacts:
    - path: "scripts/prompts/response-complete.md"
      provides: "Instructions for agent after Claude finishes responding"
    - path: "scripts/prompts/ask-user-question.md"
      provides: "Instructions for agent to answer Claude Code questions including multi-select"
    - path: "scripts/prompts/idle-prompt.md"
      provides: "Instructions for agent when Claude is waiting for input"
    - path: "scripts/prompts/permission-prompt.md"
      provides: "Instructions for agent to handle permission dialogs"
    - path: "scripts/prompts/pre-compact.md"
      provides: "Instructions for agent about context compaction"
    - path: "scripts/prompts/session-end.md"
      provides: "Instructions for agent to handle session termination"
    - path: "scripts/prompts/answer-submitted.md"
      provides: "Informational notice that answer was already submitted"
  key_links:
    - from: "scripts/prompts/ask-user-question.md"
      to: "scripts/menu-driver.sh"
      via: "{MENU_DRIVER_PATH} placeholder"
      pattern: "arrow_up|arrow_down|space"
    - from: "scripts/prompts/session-end.md"
      to: "scripts/spawn.sh"
      via: "{SCRIPT_DIR}/spawn.sh reference"
      pattern: "spawn.sh"
---

<objective>
Create all 7 per-hook prompt template files in scripts/prompts/ with hook-specific command subsets and correct placeholders.

Purpose: These templates are the content that load_hook_prompt() (from Plan 15-01) will load and substitute into wake messages during Phase 16. Each template contains only the commands and instructions relevant to its specific trigger type, replacing the current generic [AVAILABLE ACTIONS] block that lists every menu-driver command regardless of context.

Output: 7 markdown files in scripts/prompts/, each with hook-specific instructions and {SESSION_NAME}, {MENU_DRIVER_PATH}, {SCRIPT_DIR} placeholders.
</objective>

<execution_context>
@/home/forge/.claude/get-shit-done/workflows/execute-plan.md
@/home/forge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@lib/hook-utils.sh
@scripts/menu-driver.sh
@scripts/stop-hook.sh
@scripts/pre-tool-use-hook.sh
@scripts/notification-idle-hook.sh
@scripts/notification-permission-hook.sh
@scripts/pre-compact-hook.sh
@scripts/session-end-hook.sh
@scripts/post-tool-use-hook.sh
@.planning/phases/15-prompt-template-foundation/15-01-SUMMARY.md
@.planning/phases/15-prompt-template-foundation/15-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create scripts/prompts/ directory and response-complete, idle-prompt, permission-prompt templates</name>
  <files>
    scripts/prompts/response-complete.md
    scripts/prompts/idle-prompt.md
    scripts/prompts/permission-prompt.md
  </files>
  <action>
Create the `scripts/prompts/` directory with `mkdir -p`.

Create 3 template files. Each template is plain text (not rendered markdown) that will be inserted into wake messages as the [ACTION REQUIRED] section content. Use {SESSION_NAME}, {MENU_DRIVER_PATH}, and {SCRIPT_DIR} placeholders wherever session name or paths appear. Templates should be concise, actionable instructions for the driving agent.

**scripts/prompts/response-complete.md** (for stop-hook.sh — trigger: response_complete):
Claude has finished responding. The agent should review the content and decide the next action.

Relevant commands ONLY:
- `{MENU_DRIVER_PATH} {SESSION_NAME} snapshot` — take a fresh pane snapshot to see current state
- `{MENU_DRIVER_PATH} {SESSION_NAME} type <message>` — send a follow-up message to Claude
- `{MENU_DRIVER_PATH} {SESSION_NAME} enter` — press Enter (e.g., to confirm a prompt)
- `{MENU_DRIVER_PATH} {SESSION_NAME} esc` — press Escape (e.g., to dismiss a dialog)
- `{MENU_DRIVER_PATH} {SESSION_NAME} clear_then <command>` — clear context and run a slash command

NOT relevant for this trigger: choose (no numbered options presented), arrow_up/arrow_down/space (no checkbox), submit (no form).

**scripts/prompts/idle-prompt.md** (for notification-idle-hook.sh — trigger: idle_prompt):
Claude is waiting for user input. The agent should provide the next instruction or message.

Relevant commands ONLY:
- `{MENU_DRIVER_PATH} {SESSION_NAME} snapshot` — take a fresh pane snapshot to see what Claude is waiting for
- `{MENU_DRIVER_PATH} {SESSION_NAME} type <message>` — send input to Claude
- `{MENU_DRIVER_PATH} {SESSION_NAME} enter` — press Enter
- `{MENU_DRIVER_PATH} {SESSION_NAME} clear_then <command>` — clear context and run a slash command

NOT relevant: choose, esc, arrow keys, space, submit (Claude is at idle prompt, not showing options).

**scripts/prompts/permission-prompt.md** (for notification-permission-hook.sh — trigger: permission_prompt):
Claude is showing a permission dialog asking to approve or deny a tool action.

Relevant commands ONLY:
- `{MENU_DRIVER_PATH} {SESSION_NAME} snapshot` — take a pane snapshot to read the permission details
- `{MENU_DRIVER_PATH} {SESSION_NAME} choose <n>` — select a numbered option (approve/deny)
- `{MENU_DRIVER_PATH} {SESSION_NAME} enter` — press Enter to confirm selection
- `{MENU_DRIVER_PATH} {SESSION_NAME} esc` — press Escape to dismiss/deny

NOT relevant: type, clear_then, arrow keys, space, submit (permission dialogs use numbered options, not text input or checkboxes).

Format each template as a brief context line, then a labeled command list. Do NOT use markdown headers (#) — these are plain text sections embedded in wake messages. Example format:

```
Claude has finished responding. Review the [CONTENT] above and decide your next action.

Commands:
  {MENU_DRIVER_PATH} {SESSION_NAME} snapshot
  {MENU_DRIVER_PATH} {SESSION_NAME} type <message>
  ...
```
  </action>
  <verify>
```bash
ls -la scripts/prompts/response-complete.md scripts/prompts/idle-prompt.md scripts/prompts/permission-prompt.md
# All 3 files exist

# Verify placeholders are present
grep -c '{SESSION_NAME}' scripts/prompts/response-complete.md
grep -c '{MENU_DRIVER_PATH}' scripts/prompts/response-complete.md

# Verify response-complete does NOT include choose or arrow commands
grep -c 'choose\|arrow_up\|arrow_down\|space' scripts/prompts/response-complete.md
# Should be 0

# Verify permission-prompt does NOT include type or clear_then
grep -c 'type <\|clear_then' scripts/prompts/permission-prompt.md
# Should be 0

# Verify idle-prompt does NOT include choose or esc
grep -c 'choose\|esc' scripts/prompts/idle-prompt.md
# Should be 0
```
  </verify>
  <done>
Three template files exist at scripts/prompts/ with hook-specific command subsets. response-complete.md has snapshot/type/enter/esc/clear_then. idle-prompt.md has snapshot/type/enter/clear_then. permission-prompt.md has snapshot/choose/enter/esc. No template lists irrelevant commands.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ask-user-question, pre-compact, session-end, and answer-submitted templates</name>
  <files>
    scripts/prompts/ask-user-question.md
    scripts/prompts/pre-compact.md
    scripts/prompts/session-end.md
    scripts/prompts/answer-submitted.md
  </files>
  <action>
Create the remaining 4 template files:

**scripts/prompts/ask-user-question.md** (for pre-tool-use-hook.sh — trigger: ask_user_question):
Claude is asking the user a question. The agent must answer by choosing an option, typing freeform text, or handling multi-select checkboxes.

This is the most complex template. It MUST include explicit multi-select checkbox instructions per TUI-02.

Structure:
1. Brief context: "Claude is asking a question. Review the [ASK USER QUESTION] section above."
2. Single-select instructions: use `choose <n>` to select a numbered option
3. Multi-select checkbox instructions (REQUIRED per TUI-02): When the question shows checkboxes (Multi-select: yes), use:
   - `{MENU_DRIVER_PATH} {SESSION_NAME} arrow_down` — move cursor down to next option
   - `{MENU_DRIVER_PATH} {SESSION_NAME} arrow_up` — move cursor up to previous option
   - `{MENU_DRIVER_PATH} {SESSION_NAME} space` — toggle checkbox on/off for current option
   - `{MENU_DRIVER_PATH} {SESSION_NAME} enter` — confirm selection and submit
   Typical flow: arrow_down to navigate, space to toggle each desired option, enter to confirm.
4. Freeform text: `{MENU_DRIVER_PATH} {SESSION_NAME} type <text>` for open-ended questions
5. Snapshot: `{MENU_DRIVER_PATH} {SESSION_NAME} snapshot` to see the current TUI state

NOT relevant: clear_then, esc (AskUserQuestion requires an answer, cannot be escaped).

**scripts/prompts/pre-compact.md** (for pre-compact-hook.sh — trigger: pre_compact):
Context compaction is about to happen. This is primarily informational. The agent may optionally take a snapshot or clear context.

Relevant commands (minimal):
- `{MENU_DRIVER_PATH} {SESSION_NAME} snapshot` — take a pane snapshot before compaction
- `{MENU_DRIVER_PATH} {SESSION_NAME} clear_then <command>` — optionally clear and restart if context is critically high

Brief, informational tone: "Context compaction is imminent. The session will continue after compaction. No action is usually needed."

**scripts/prompts/session-end.md** (for session-end-hook.sh — trigger: session_end):
The Claude Code session has terminated. The agent should restart it if needed.

This template does NOT use menu-driver commands (the session is dead — no pane to interact with). Instead, reference spawn.sh:
- `{SCRIPT_DIR}/spawn.sh <session-name> <workdir>` — restart the session

Brief, actionable: "The session has ended. To restart, use spawn.sh."

**scripts/prompts/answer-submitted.md** (for post-tool-use-hook.sh — trigger: ask_user_question_answered):
The user's answer has been submitted to Claude. This is purely informational — no TUI action is needed.

This template has NO commands at all. It should be a brief informational notice:
"The answer has been submitted. Claude is now processing the response. No action is needed."

Format: Same plain text format as Task 1 templates. No markdown headers.
  </action>
  <verify>
```bash
ls -la scripts/prompts/ask-user-question.md scripts/prompts/pre-compact.md scripts/prompts/session-end.md scripts/prompts/answer-submitted.md
# All 4 files exist

# Verify ask-user-question includes multi-select instructions (TUI-02)
grep -c 'arrow_up\|arrow_down\|space' scripts/prompts/ask-user-question.md
# Should be at least 3

# Verify ask-user-question includes choose for single-select
grep -c 'choose' scripts/prompts/ask-user-question.md
# Should be at least 1

# Verify answer-submitted has NO menu-driver commands
grep -c 'MENU_DRIVER_PATH\|menu-driver' scripts/prompts/answer-submitted.md
# Should be 0

# Verify session-end references spawn.sh, not menu-driver
grep -c 'spawn.sh' scripts/prompts/session-end.md
# Should be at least 1
grep -c 'MENU_DRIVER_PATH' scripts/prompts/session-end.md
# Should be 0

# Count total templates
ls scripts/prompts/*.md | wc -l
# Should be 7
```
  </verify>
  <done>
All 7 template files exist at scripts/prompts/. ask-user-question.md includes explicit multi-select checkbox instructions with arrow_up, arrow_down, space, and enter flow. answer-submitted.md is informational with no TUI commands. session-end.md references spawn.sh for restart. Each template contains only commands relevant to its trigger type.
  </done>
</task>

</tasks>

<verification>
1. `ls scripts/prompts/*.md | wc -l` returns 7
2. All 7 filenames match: response-complete.md, ask-user-question.md, idle-prompt.md, permission-prompt.md, pre-compact.md, session-end.md, answer-submitted.md
3. ask-user-question.md contains arrow_up, arrow_down, space instructions (TUI-02)
4. answer-submitted.md contains no menu-driver commands
5. session-end.md contains no menu-driver commands but references spawn.sh
6. No template lists all menu-driver commands — each has only its relevant subset
7. All templates use {SESSION_NAME} and {MENU_DRIVER_PATH} or {SCRIPT_DIR} placeholders where paths appear
</verification>

<success_criteria>
- 7 template files created in scripts/prompts/
- Each template has only commands relevant to its trigger context
- ask-user-question.md includes multi-select checkbox navigation instructions (arrow_up/arrow_down/space/enter)
- answer-submitted.md and session-end.md have no menu-driver commands (informational or spawn-based)
- All templates use the 3 standard placeholders for dynamic content
</success_criteria>

<output>
After completion, create `.planning/phases/15-prompt-template-foundation/15-03-SUMMARY.md`
</output>
