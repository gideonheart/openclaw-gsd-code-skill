---
phase: 16-hook-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/stop-hook.sh
  - scripts/notification-idle-hook.sh
  - scripts/notification-permission-hook.sh
autonomous: true
requirements:
  - HOOK-18
  - HOOK-19
  - HOOK-20

must_haves:
  truths:
    - "stop-hook.sh wake message contains [ACTION REQUIRED] loaded from response-complete template"
    - "notification-idle-hook.sh wake message contains [ACTION REQUIRED] loaded from idle-prompt template"
    - "notification-permission-hook.sh wake message contains [ACTION REQUIRED] loaded from permission-prompt template"
    - "None of the three hooks contain [AVAILABLE ACTIONS] anywhere in their source"
    - "If a template file is missing, the hook still fires and delivers the wake message"
  artifacts:
    - path: "scripts/stop-hook.sh"
      provides: "Response-complete wake with [ACTION REQUIRED] from template"
      contains: "load_hook_prompt"
    - path: "scripts/notification-idle-hook.sh"
      provides: "Idle-prompt wake with [ACTION REQUIRED] from template"
      contains: "load_hook_prompt"
    - path: "scripts/notification-permission-hook.sh"
      provides: "Permission-prompt wake with [ACTION REQUIRED] from template"
      contains: "load_hook_prompt"
  key_links:
    - from: "scripts/stop-hook.sh"
      to: "scripts/prompts/response-complete.md"
      via: "load_hook_prompt call"
      pattern: 'load_hook_prompt "response-complete"'
    - from: "scripts/notification-idle-hook.sh"
      to: "scripts/prompts/idle-prompt.md"
      via: "load_hook_prompt call"
      pattern: 'load_hook_prompt "idle-prompt"'
    - from: "scripts/notification-permission-hook.sh"
      to: "scripts/prompts/permission-prompt.md"
      via: "load_hook_prompt call"
      pattern: 'load_hook_prompt "permission-prompt"'
---

<objective>
Migrate stop-hook.sh, notification-idle-hook.sh, and notification-permission-hook.sh from hardcoded [AVAILABLE ACTIONS] to template-loaded [ACTION REQUIRED] sections via load_hook_prompt().

Purpose: These three hooks currently have identical generic action blocks. After migration, each hook will load its hook-specific prompt template, giving the driving agent only the commands relevant to that trigger context.

Output: Three modified hook scripts, each calling load_hook_prompt() with their specific template name and emitting [ACTION REQUIRED] instead of [AVAILABLE ACTIONS].
</objective>

<execution_context>
@/home/forge/.claude/get-shit-done/workflows/execute-plan.md
@/home/forge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@scripts/stop-hook.sh
@scripts/notification-idle-hook.sh
@scripts/notification-permission-hook.sh
@lib/hook-utils.sh
@scripts/prompts/response-complete.md
@scripts/prompts/idle-prompt.md
@scripts/prompts/permission-prompt.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate stop-hook.sh to load_hook_prompt("response-complete")</name>
  <files>scripts/stop-hook.sh</files>
  <action>
In scripts/stop-hook.sh, replace the hardcoded [AVAILABLE ACTIONS] block (lines 162-169) with a template-loaded [ACTION REQUIRED] section.

Before the WAKE_MESSAGE construction (before section 10), add three lines to compute paths and load the template:

```bash
MENU_DRIVER_PATH="${_GSD_SKILL_ROOT}/scripts/menu-driver.sh"
SCRIPT_DIR="${_GSD_SKILL_ROOT}/scripts"
ACTION_PROMPT=$(load_hook_prompt "response-complete" "$SESSION_NAME" "$MENU_DRIVER_PATH" "$SCRIPT_DIR")
```

Then in the WAKE_MESSAGE heredoc, replace the entire block:
```
[AVAILABLE ACTIONS]
menu-driver.sh ${SESSION_NAME} choose <n>
menu-driver.sh ${SESSION_NAME} type <text>
menu-driver.sh ${SESSION_NAME} clear_then <command>
menu-driver.sh ${SESSION_NAME} enter
menu-driver.sh ${SESSION_NAME} esc
menu-driver.sh ${SESSION_NAME} submit
menu-driver.sh ${SESSION_NAME} snapshot
```

with:
```
[ACTION REQUIRED]
${ACTION_PROMPT}
```

Do NOT change any other part of the wake message structure. The [SESSION IDENTITY], [TRIGGER], [CONTENT], [STATE HINT], and [CONTEXT PRESSURE] sections remain unchanged.
  </action>
  <verify>
Run: grep -c "AVAILABLE ACTIONS" scripts/stop-hook.sh (must return 0)
Run: grep -c "ACTION REQUIRED" scripts/stop-hook.sh (must return 1)
Run: grep -c "load_hook_prompt" scripts/stop-hook.sh (must return 1)
Run: grep 'load_hook_prompt "response-complete"' scripts/stop-hook.sh (must match)
Run: bash -n scripts/stop-hook.sh (syntax check passes)
  </verify>
  <done>stop-hook.sh calls load_hook_prompt("response-complete") and emits [ACTION REQUIRED] with template content. Zero occurrences of [AVAILABLE ACTIONS] remain. Script passes bash syntax check.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate notification-idle-hook.sh and notification-permission-hook.sh</name>
  <files>scripts/notification-idle-hook.sh, scripts/notification-permission-hook.sh</files>
  <action>
Apply the identical pattern to both notification hooks:

**notification-idle-hook.sh:**
Before the WAKE_MESSAGE construction (before section 9), add:
```bash
MENU_DRIVER_PATH="${_GSD_SKILL_ROOT}/scripts/menu-driver.sh"
SCRIPT_DIR="${_GSD_SKILL_ROOT}/scripts"
ACTION_PROMPT=$(load_hook_prompt "idle-prompt" "$SESSION_NAME" "$MENU_DRIVER_PATH" "$SCRIPT_DIR")
```

Replace the [AVAILABLE ACTIONS] block (lines 123-130) in WAKE_MESSAGE with:
```
[ACTION REQUIRED]
${ACTION_PROMPT}
```

**notification-permission-hook.sh:**
Before the WAKE_MESSAGE construction (before section 9), add:
```bash
MENU_DRIVER_PATH="${_GSD_SKILL_ROOT}/scripts/menu-driver.sh"
SCRIPT_DIR="${_GSD_SKILL_ROOT}/scripts"
ACTION_PROMPT=$(load_hook_prompt "permission-prompt" "$SESSION_NAME" "$MENU_DRIVER_PATH" "$SCRIPT_DIR")
```

Replace the [AVAILABLE ACTIONS] block (lines 124-131) in WAKE_MESSAGE with:
```
[ACTION REQUIRED]
${ACTION_PROMPT}
```

Do NOT change any other wake message sections in either file.
  </action>
  <verify>
For each hook (notification-idle-hook.sh, notification-permission-hook.sh):
Run: grep -c "AVAILABLE ACTIONS" scripts/notification-idle-hook.sh (must return 0)
Run: grep -c "ACTION REQUIRED" scripts/notification-idle-hook.sh (must return 1)
Run: grep 'load_hook_prompt "idle-prompt"' scripts/notification-idle-hook.sh (must match)
Run: grep -c "AVAILABLE ACTIONS" scripts/notification-permission-hook.sh (must return 0)
Run: grep -c "ACTION REQUIRED" scripts/notification-permission-hook.sh (must return 1)
Run: grep 'load_hook_prompt "permission-prompt"' scripts/notification-permission-hook.sh (must match)
Run: bash -n scripts/notification-idle-hook.sh && bash -n scripts/notification-permission-hook.sh (syntax check passes for both)
  </verify>
  <done>Both notification hooks call load_hook_prompt() with their correct template names ("idle-prompt" and "permission-prompt" respectively) and emit [ACTION REQUIRED]. Zero [AVAILABLE ACTIONS] occurrences in either file. Both pass bash syntax check.</done>
</task>

</tasks>

<verification>
Cross-hook verification for Plan 01:
1. grep -c "AVAILABLE ACTIONS" scripts/stop-hook.sh scripts/notification-idle-hook.sh scripts/notification-permission-hook.sh — all three must return 0
2. grep -c "ACTION REQUIRED" scripts/stop-hook.sh scripts/notification-idle-hook.sh scripts/notification-permission-hook.sh — all three must return 1
3. grep "load_hook_prompt" scripts/stop-hook.sh scripts/notification-idle-hook.sh scripts/notification-permission-hook.sh — all three must show their correct template name
4. bash -n on all three scripts — no syntax errors
</verification>

<success_criteria>
- stop-hook.sh loads "response-complete" template via load_hook_prompt() and emits [ACTION REQUIRED]
- notification-idle-hook.sh loads "idle-prompt" template via load_hook_prompt() and emits [ACTION REQUIRED]
- notification-permission-hook.sh loads "permission-prompt" template via load_hook_prompt() and emits [ACTION REQUIRED]
- Zero occurrences of [AVAILABLE ACTIONS] across all three scripts
- All three scripts pass bash -n syntax check
</success_criteria>

<output>
After completion, create `.planning/phases/16-hook-migration/16-01-SUMMARY.md`
</output>
